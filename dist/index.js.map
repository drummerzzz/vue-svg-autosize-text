{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"AAAA;;AAEA,MAAM,CAAC,cAAP,CAAsB,OAAtB,EAA+B,YAA/B,EAA6C;AAC3C,EAAA,KAAK,EAAE;AADoC,CAA7C;AAGA,OAAO,CAAC,iBAAR,GAA4B,OAAO,CAAC,SAAD,CAAP,GAAqB,KAAK,CAAtD;AACA,IAAI,MAAM,GAAG,4BAAb;AACA,IAAI,UAAU,GAAG;AACf,SAAO,IADQ;AAEf,cAAY,IAFG;AAGf,YAAU,IAHK;AAIf,YAAU;AAJK,CAAjB;;AAOA,SAAS,SAAT,CAAmB,GAAnB,EAAwB,GAAxB,EAA6B;AAC3B,MAAI,GAAG,GAAG;AACR,aAAS,CAAC,GAAG,CAAC,KAAL,GAAa,KAAb,GAAqB,IADtB;AAER,SAAK,CAAC,GAAG,CAAC,CAAL,GAAS,CAAT,GAAa,GAAG,CAAC,CAFd;AAGR,aAAS,QAAQ,GAAG,CAAC,KAHb;AAIR,cAAU,QAAQ,GAAG,CAAC,MAJd;AAKR,aAAS,GAAG,CAAC,KAAJ,KAAc,MAAd,IAAwB,GAAG,CAAC,KAAJ,KAAc,KAAtC,GAA8C,KAA9C,GAAsD,UAAU,CAAC,GAAG,CAAC,KAAL,CAAV,GAAwB,GAAG,CAAC,KAA5B,GAAoC,UAL3F;AAMR,kBAAc,GAAG,CAAC,UAAJ,IAAkB,SANxB;AAOR,mBAAe,CAAC,GAAG,CAAC,WAAL,GAAmB,CAAC,GAAG,CAAC,OAAL,GAAe,CAAf,GAAmB,GAAG,CAAC,OAA1C,GAAoD,GAAG,CAAC,WAP/D;AAQR,oBAAgB,CAAC,GAAG,CAAC,YAAL,GAAoB,CAAC,GAAG,CAAC,OAAL,GAAe,CAAf,GAAmB,GAAG,CAAC,OAA3C,GAAqD,GAAG,CAAC,YARjE;AASR,mBAAe,GAAG,CAAC,WAAJ,YAA2B,QAA3B,GAAsC,GAAG,CAAC,WAA1C,GAAwD,KAT/D;AAUR,2BAAuB,GAAG,CAAC,mBAAJ,GAA0B,IAA1B,GAAiC;AAVhD,GAAV;AAYA,EAAA,GAAG,CAAC,QAAJ,GAAe,GAAG,CAAC,WAAJ,GAAkB,GAAG,CAAC,YAArC;;AAEA,OAAK,IAAI,CAAT,IAAc,GAAd,EAAmB;AACjB,QAAI,CAAC,KAAK,OAAV,EAAmB,GAAG,CAAC,KAAJ,GAAY,IAAZ,CAAnB,KAAyC,IAAI,UAAU,CAAC,CAAD,CAAd,EAAmB;AAC1D,MAAA,GAAG,CAAC,KAAJ,GAAY,CAAZ;AACD,KAFwC,MAElC,IAAI,CAAC,KAAK,MAAV,EAAkB;AACvB,MAAA,GAAG,CAAC,KAAJ,GAAY,KAAZ;AACD,KAFM,MAEA,IAAI,MAAM,IAAN,CAAW,CAAX,CAAJ,EAAmB,GAAG,CAAC,KAAJ,GAAY,QAAQ,CAAC,CAAD,CAApB;AAC3B;;AAED,SAAO,GAAP;AACD;;AAED,IAAI,QAAQ,GAAG,GAAf;;AAEA,SAAS,OAAT,CAAiB,EAAjB,EAAqB,IAArB,EAA2B,MAA3B,EAAmC;AACjC,MAAI,GAAG,GAAG,IAAI,CAAC,SAAL,EAAV;AACA,EAAA,EAAE,CAAC,YAAH,CAAgB,GAAhB,EAAqB,IAAI,CAAC,WAA1B;AACA,EAAA,IAAI,CAAC,KAAL,CAAW,OAAX,GAAqB,EAArB;AACA,EAAA,GAAG,CAAC,eAAJ,CAAoB,GAApB;AACA,EAAA,GAAG,CAAC,YAAJ,CAAiB,IAAjB,EAAuB,MAAM,CAAC,UAA9B;AAEA,EAAA,GAAG,CAAC,YAAJ,CAAiB,GAAjB,EAAsB,MAAM,CAAC,CAA7B;AAGA,SAAO,GAAP;AACD;;AAED,SAAS,WAAT,CAAqB,EAArB,EAAyB,IAAzB,EAA+B,MAA/B,EAAuC;AACrC,EAAA,EAAE,CAAC,MAAM,CAAC,KAAP,GAAe,aAAf,GAA+B,WAAhC,CAAF,GAAiD,IAAI,IAAI,EAAzD;AACA,MAAI,MAAM,GAAG,MAAM,CAAC,mBAAP,GAA6B,CAA7B,GAAiC,EAAE,CAAC,YAAH,CAAgB,OAAhB,CAAwB,OAAxB,CAAgC,KAAhC,GAAwC,EAAE,CAAC,YAAH,CAAgB,qBAAhB,GAAwC,KAA9H;AACA,MAAI,KAAK,GAAG,EAAZ;;AAEA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,EAAE,CAAC,UAAH,CAAc,MAAlC,EAA0C,CAAC,EAA3C,EAA+C;AAC7C,QAAI,CAAC,GAAG,EAAE,CAAC,UAAH,CAAc,CAAd,CAAR;;AAEA,QAAI,CAAC,YAAY,IAAjB,EAAuB;AACrB,UAAI,GAAG,GAAG,QAAQ,CAAC,eAAT,CAAyB,MAAzB,EAAiC,OAAjC,CAAV;AACA,MAAA,GAAG,CAAC,WAAJ,GAAkB,CAAC,CAAC,WAApB;AACA,MAAA,EAAE,CAAC,YAAH,CAAgB,GAAhB,EAAqB,CAArB;AACA,MAAA,CAAC,GAAG,GAAJ;AACD;;AAED,QAAI,MAAM,CAAC,KAAX,EAAkB;AAChB,MAAA,KAAK,CAAC,IAAN,CAAW,CAAC,CAAC,WAAF,CAAc,KAAd,CAAoB,IAApB,CAAX;AACA,MAAA,CAAC,CAAC,WAAF,GAAgB,EAAhB;AACD;AACF;;AAMD,MAAI,MAAM,CAAC,KAAX,EAAkB;AAChB,SAAK,IAAI,EAAE,GAAG,CAAd,EAAiB,EAAE,GAAG,EAAE,CAAC,UAAH,CAAc,MAApC,EAA4C,EAAE,EAA9C,EAAkD;AAChD,UAAI,EAAE,GAAG,EAAE,CAAC,UAAH,CAAc,EAAd,CAAT;;AAEA,UAAI,EAAE,YAAY,IAAlB,EAAwB;AACtB,YAAI,IAAI,GAAG,QAAQ,CAAC,eAAT,CAAyB,MAAzB,EAAiC,OAAjC,CAAX;;AAEA,QAAA,IAAI,CAAC,WAAL,GAAmB,EAAE,CAAC,WAAtB;AACA,QAAA,EAAE,CAAC,YAAH,CAAgB,IAAhB,EAAsB,EAAtB;AACA,QAAA,EAAE,GAAG,IAAL;AACD;;AAED,MAAA,KAAK,CAAC,IAAN,CAAW,EAAE,CAAC,WAAH,CAAe,KAAf,CAAqB,IAArB,CAAX;AACD;;AAED,QAAI,MAAM,GAAG,CAAb;AAAA,QACI,CAAC,GAAG,MAAM,CAAC,KAAP,GAAe,MAAM,CAAC,QAD9B;AAAA,QAEI,QAAQ,GAAG,EAAE,CAAC,iBAFlB;;AAIA,SAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,QAApB,EAA8B,CAAC,EAA/B,EAAmC;AACjC,UAAI,KAAK,GAAG,KAAK,CAAC,CAAD,CAAjB;AACA,UAAI,EAAE,GAAG,KAAK,CAAC,MAAf;AAAA,UACI,IAAI,GAAG,EAAE,CAAC,UAAH,CAAc,CAAC,GAAG,MAAlB,CADX;AAAA,UAEI,GAAG,GAAG,EAFV;AAAA,UAGI,UAAU,GAAG,KAHjB;;AAKA,WAAK,IAAI,GAAG,GAAG,CAAf,EAAkB,GAAG,GAAG,EAAxB,EAA4B,GAAG,EAA/B,EAAmC;AACjC,QAAA,IAAI,CAAC,WAAL,IAAoB,GAAG,GAAG,MAAM,KAAK,CAAC,GAAD,CAAd,GAAsB,KAAK,CAAC,GAAD,CAAlD;AACA,QAAA,UAAU,GAAG,EAAE,CAAC,qBAAH,GAA2B,KAA3B,GAAmC,MAAnC,GAA4C,CAAzD;;AAEA,eAAO,UAAP,EAAmB;AACjB,UAAA,IAAI,CAAC,WAAL,GAAmB,GAAnB;AACA,UAAA,IAAI,GAAG,OAAO,CAAC,EAAD,EAAK,IAAL,EAAW,MAAX,CAAd;AACA,UAAA,GAAG,GAAG,IAAI,CAAC,WAAL,GAAmB,KAAK,CAAC,GAAD,CAA9B;AACA,UAAA,MAAM;;AAEN,cAAI,EAAE,CAAC,qBAAH,GAA2B,KAA3B,GAAmC,MAAnC,GAA4C,CAAhD,EAAmD;AACjD,YAAA,IAAI,CAAC,KAAL,CAAW,OAAX,GAAqB,MAArB;AACA,YAAA,GAAG,GAAG,KAAK,CAAC,EAAE,GAAH,CAAX;AACA,gBAAI,CAAC,GAAL,EAAU,UAAU,GAAG,KAAb;AACX,WAJD,MAIO,UAAU,GAAG,KAAb;AACR;;AAED,QAAA,GAAG,GAAG,IAAI,CAAC,WAAX;AACD;AACF;AACF;AACF;;AAED,SAAS,GAAT,CAAa,EAAb,EAAiB,IAAjB,EAAuB,MAAvB,EAA+B;AAC7B,EAAA,EAAE,CAAC,MAAM,CAAC,KAAP,GAAe,aAAf,GAA+B,WAAhC,CAAF,GAAiD,IAAI,IAAI,EAAzD;AACA,MAAI,MAAM,GAAG,MAAM,CAAC,mBAAP,GAA6B,CAA7B,GAAiC,EAAE,CAAC,YAAH,CAAgB,OAAhB,CAAwB,OAAxB,CAAgC,MAAhC,GAAyC,EAAE,CAAC,YAAH,CAAgB,qBAAhB,GAAwC,MAA/H;AACA,EAAA,EAAE,CAAC,YAAH,CAAgB,WAAhB,EAA6B,GAA7B;AACA,EAAA,WAAW,CAAC,EAAD,EAAK,IAAL,EAAW,MAAX,CAAX;;AAEA,MAAI,MAAM,CAAC,MAAX,EAAmB;AACjB,QAAI,WAAW,GAAG,EAAE,CAAC,qBAAH,GAA2B,MAA3B,GAAoC,MAApC,GAA6C,MAAM,CAAC,MAAtE;;AAEA,WAAO,WAAP,EAAoB;AAClB,UAAI,IAAI,GAAG,EAAE,CAAC,YAAH,CAAgB,WAAhB,CAAX;AACA,UAAI,MAAM,GAAG,EAAE,CAAC,qBAAH,GAA2B,MAA3B,GAAoC,MAAjD;;AAEA,UAAI,MAAM,GAAG,MAAM,CAAC,MAApB,EAA4B;AAC1B,QAAA,EAAE,CAAC,YAAH,CAAgB,WAAhB,EAA6B,IAAI,GAAE,CAAnC;AACD,OAFD,MAEO;AACL,QAAA,WAAW,GAAG,KAAd;AACA,QAAA,WAAW,CAAC,EAAD,EAAK,IAAL,EAAW,MAAX,CAAX;AACD;AACF;AACF;;AAED,MAAI,CAAC,EAAE,CAAC,UAAH,CAAc,MAAnB,EAA2B;;AAE3B,OAAK,IAAI,GAAG,GAAG,CAAf,EAAkB,GAAG,GAAG,EAAE,CAAC,UAAH,CAAc,MAAtC,EAA8C,GAAG,EAAjD,EAAqD;AACnD,IAAA,EAAE,CAAC,UAAH,CAAc,GAAd,EAAmB,KAAnB,CAAyB,OAAzB,GAAmC,EAAnC;AACD;;AACD,EAAA,EAAE,CAAC,YAAH,CAAgB,GAAhB,EAAqB,MAAM,CAAC,CAA5B;AACA,EAAA,QAAQ,GAAG,EAAE,CAAC,YAAH,CAAgB,WAAhB,CAAX;AACD;;AAED,SAAS,SAAT,CAAmB,MAAnB,EAA2B;AACzB,MAAI,CAAC,MAAL,EAAa,MAAM,GAAG,EAAT;AACb,MAAI,CAAC,GAAG;AACN,IAAA,QAAQ,EAAE,SAAS,QAAT,CAAkB,EAAlB,EAAsB,OAAtB,EAA+B;AACvC,UAAI,EAAE,EAAE,YAAY,cAAhB,CAAJ,EAAqC,MAAM,IAAI,KAAJ,CAAU,2DAAV,CAAN;AACrC,MAAA,EAAE,CAAC,aAAH,GAAmB,SAAS,CAAC,OAAO,CAAC,SAAT,EAAoB,MAApB,CAA5B;AACA,MAAA,EAAE,CAAC,YAAH,GAAkB,EAAE,CAAC,UAArB;;AAEA,aAAO,EAAE,EAAE,CAAC,YAAH,YAA2B,aAA7B,CAAP,EAAoD;AAClD,QAAA,EAAE,CAAC,YAAH,GAAkB,EAAE,CAAC,YAAH,CAAgB,UAAlC;AACD;;AAED,MAAA,CAAC,CAAC,MAAF,CAAS,KAAT,CAAe,IAAf,EAAqB,SAArB;AACD,KAXK;AAYN,IAAA,MAAM,EAAE,SAAS,MAAT,CAAgB,EAAhB,EAAoB,OAApB,EAA6B,IAA7B,EAAmC;AACzC,UAAI,OAAO,GAAG,IAAI,CAAC,OAAnB;;AAEA,UAAI,OAAO,CAAC,KAAR,IAAiB,OAAO,CAAC,QAA7B,EAAuC;AACrC,YAAI,GAAG,GAAG,EAAE,CAAC,aAAb;;AAEA,YAAI,OAAO,CAAC,KAAR,IAAiB,OAAO,OAAO,CAAC,KAAf,KAAyB,QAA9C,EAAwD;AACtD,cAAI,IAAI,GAAG,OAAO,CAAC,KAAR,CAAc,IAAzB;AACA,UAAA,GAAG,GAAG,SAAS,CAAC,EAAD,EAAK,MAAM,CAAC,MAAP,CAAc,EAAd,EAAkB,EAAE,CAAC,aAArB,EAAoC,OAAO,CAAC,KAA5C,CAAL,CAAf;AACA,UAAA,GAAG,CAAC,EAAD,EAAK,IAAL,EAAW,GAAX,CAAH;AACD,SAJD,MAIO,GAAG,CAAC,EAAD,EAAK,OAAO,CAAC,KAAb,EAAoB,GAApB,CAAH;;AAEP,YAAI,GAAG,CAAC,WAAR,EAAqB,GAAG,CAAC,WAAJ,CAAgB,IAAhB,CAAqB,OAArB,EAA8B,EAA9B,EAAkC,GAAlC;AACtB;AACF,KA1BK;AA2BN,IAAA,MAAM,EAAE,SAAS,MAAT,CAAgB,EAAhB,EAAoB;AAC1B,aAAO,EAAE,CAAC,aAAV;AACD;AA7BK,GAAR;AA+BA,SAAO,CAAP;AACD;;AAED,IAAI,OAAO,GAAG,SAAS,EAAvB;AACA,IAAI,QAAQ,GAAG,OAAf;AACA,OAAO,CAAC,SAAD,CAAP,GAAqB,QAArB;AACA,IAAI,iBAAiB,GAAG,SAAxB;AACA,OAAO,CAAC,iBAAR,GAA4B,iBAA5B;AACA,OAAO,CAAC,OAAR,GAAkB,QAAlB;AACA,OAAO,CAAC,QAAR,GAAmB,QAAnB","file":"index.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ConfiguredWrapper = exports[\"default\"] = void 0;\nvar SVG_NS = 'http://www.w3.org/2000/svg';\nvar alignments = {\n  'top': true,\n  'baseline': true,\n  'bottom': true,\n  'middle': true\n};\n\nfunction getConfig(mod, cfg) {\n  var ret = {\n    'plain': !cfg.plain ? false : true,\n    'x': !cfg.x ? 0 : cfg.x,\n    'width': null || cfg.width,\n    'height': null || cfg.height,\n    'align': cfg.align === 'none' || cfg.align === false ? false : alignments[cfg.align] ? cfg.align : 'baseline',\n    'lineHeight': cfg.lineHeight || '1.125em',\n    'paddingLeft': !cfg.paddingLeft ? !cfg.padding ? 0 : cfg.padding : cfg.paddingLeft,\n    'paddingRight': !cfg.paddingRight ? !cfg.padding ? 0 : cfg.padding : cfg.paddingRight,\n    'afterReflow': cfg.afterReflow instanceof Function ? cfg.afterReflow : false,\n    'physicalMeasurement': cfg.physicalMeasurement ? true : false\n  };\n  ret._padding = ret.paddingLeft + ret.paddingRight;\n\n  for (var k in mod) {\n    if (k === 'plain') ret.plain = true;else if (alignments[k]) {\n      ret.align = k;\n    } else if (k === 'none') {\n      ret.align = false;\n    } else if (/\\d+/.test(k)) ret.width = parseInt(k);\n  }\n\n  return ret;\n}\n\nvar fontSize = 150\n\nfunction newLine(el, span, config) {\n  var tmp = span.cloneNode();\n  el.insertBefore(tmp, span.nextSibling);\n  span.style.display = '';\n  tmp.removeAttribute('y');\n  tmp.setAttribute('dy', config.lineHeight);\n  //if (config.x)\n  tmp.setAttribute('x', config.x);\n  // tmp.setAttribute('rx',20)\n  // tmp.setAttribute('ry', 20)\n  return tmp;\n}\n\nfunction resizeWidth(el, text, config) {\n  el[config.plain ? 'textContent' : 'innerHTML'] = text || '';\n  var pscale = config.physicalMeasurement ? 1 : el.__OWNING_SVG.viewBox.animVal.width / el.__OWNING_SVG.getBoundingClientRect().width;\n  var plain = [];\n\n  for (var i = 0; i < el.childNodes.length; i++) {\n    var n = el.childNodes[i];\n\n    if (n instanceof Text) {\n      var tmp = document.createElementNS(SVG_NS, 'tspan');\n      tmp.textContent = n.textContent;\n      el.replaceChild(tmp, n);\n      n = tmp;\n    }\n\n    if (config.width) {\n      plain.push(n.textContent.split(/\\s/));\n      n.textContent = '';\n    }\n  }\n\n  // if (config.align) {\n  //   el.childNodes[0].setAttribute('x', config.paddingLeft);\n  // }\n\n  if (config.width) {\n    for (var _i = 0; _i < el.childNodes.length; _i++) {\n      var _n = el.childNodes[_i];\n\n      if (_n instanceof Text) {\n        var _tmp = document.createElementNS(SVG_NS, 'tspan');\n\n        _tmp.textContent = _n.textContent;\n        el.replaceChild(_tmp, _n);\n        _n = _tmp;\n      }\n\n      plain.push(_n.textContent.split(/\\s/));\n    }\n\n    var offset = 0,\n        w = config.width - config._padding,\n        childCnt = el.childElementCount;\n\n    for (var c = 0; c < childCnt; c++) {\n      var words = plain[c];\n      var wc = words.length,\n          span = el.childNodes[c + offset],\n          txt = '',\n          forceBreak = false;\n\n      for (var _i2 = 0; _i2 < wc; _i2++) {\n        span.textContent += _i2 ? ' ' + words[_i2] : words[_i2];\n        forceBreak = el.getBoundingClientRect().width * pscale > w;\n\n        while (forceBreak) {\n          span.textContent = txt;\n          span = newLine(el, span, config);\n          txt = span.textContent = words[_i2];\n          offset++;\n\n          if (el.getBoundingClientRect().width * pscale > w) {\n            span.style.display = 'none';\n            txt = words[++_i2];\n            if (!txt) forceBreak = false;\n          } else forceBreak = false;\n        }\n\n        txt = span.textContent;\n      }\n    }\n  }\n}\n\nfunction set(el, text, config) {\n  el[config.plain ? 'textContent' : 'innerHTML'] = text || '';\n  var pscale = config.physicalMeasurement ? 1 : el.__OWNING_SVG.viewBox.animVal.height / el.__OWNING_SVG.getBoundingClientRect().height;\n  el.setAttribute('font-size', 150);\n  resizeWidth(el, text, config);\n\n  if (config.height) {\n    var forceResize = el.getBoundingClientRect().height * pscale > config.height;\n\n    while (forceResize) {\n      var size = el.getAttribute('font-size');\n      var height = el.getBoundingClientRect().height * pscale;\n\n      if (height > config.height) {\n        el.setAttribute('font-size', size -1);\n      } else {\n        forceResize = false;\n        resizeWidth(el, text, config);\n      }\n    }\n  }\n\n  if (!el.childNodes.length) return;\n\n  for (var _i3 = 0; _i3 < el.childNodes.length; _i3++) {\n    el.childNodes[_i3].style.display = '';\n  }\n  el.setAttribute('x', config.x);\n  fontSize = el.getAttribute('font-size')\n}\n\nfunction directive(config) {\n  if (!config) config = {};\n  var r = {\n    inserted: function inserted(el, binding) {\n      if (!(el instanceof SVGTextElement)) throw new Error('Text-wrap directive must be bound to an SVG text element.');\n      el.__WRAP_CONFIG = getConfig(binding.modifiers, config);\n      el.__OWNING_SVG = el.parentNode;\n\n      while (!(el.__OWNING_SVG instanceof SVGSVGElement)) {\n        el.__OWNING_SVG = el.__OWNING_SVG.parentNode;\n      }\n\n      r.update.apply(this, arguments);\n    },\n    update: function update(el, binding, _ref) {\n      var context = _ref.context;\n\n      if (binding.value != binding.oldValue) {\n        var cfg = el.__WRAP_CONFIG;\n\n        if (binding.value && typeof binding.value !== 'string') {\n          var text = binding.value.text;\n          cfg = getConfig({}, Object.assign({}, el.__WRAP_CONFIG, binding.value));\n          set(el, text, cfg);\n        } else set(el, binding.value, cfg);\n\n        if (cfg.afterReflow) cfg.afterReflow.call(context, el, cfg);\n      }\n    },\n    unbind: function unbind(el) {\n      delete el.__WRAP_CONFIG;\n    }\n  };\n  return r;\n}\n\nvar Wrapper = directive();\nvar _default = Wrapper;\nexports[\"default\"] = _default;\nvar ConfiguredWrapper = directive;\nexports.ConfiguredWrapper = ConfiguredWrapper;\nexports.wrapper = _default\nexports.fontSize = fontSize\n//# sourceMappingURL=index.js.map"]}